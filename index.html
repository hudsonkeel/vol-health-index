<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>StaffHealth Stability Index (SHSI) Prototype</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">

  <!-- Inline styles so there are NO external file dependencies -->
  <style>
    body {
      font-family: Arial, sans-serif;
      margin: 20px;
      line-height: 1.4;
    }

    h1, h2 {
      margin-bottom: 0.4rem;
    }

    .subheading {
      color: #555;
      margin-bottom: 1.5rem;
      font-size: 0.95rem;
    }

    .nav-buttons {
      margin-bottom: 1.5rem;
    }

    button {
      padding: 0.5rem 1rem;
      margin-right: 0.5rem;
      border-radius: 4px;
      border: 1px solid #ccc;
      cursor: pointer;
      background: #f4f4f4;
    }

    button.active {
      background: #007bff;
      color: #fff;
      border-color: #007bff;
    }

    .section {
      display: none;
    }

    .section.active {
      display: block;
    }

    .form-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-bottom: 0.75rem;
    }

    .form-field {
      min-width: 180px;
    }

    label {
      display: block;
      font-size: 0.85rem;
      margin-bottom: 0.2rem;
    }

    input[type="number"],
    input[type="text"] {
      width: 100%;
      padding: 0.35rem;
      box-sizing: border-box;
    }

    .kpi-row {
      display: flex;
      flex-wrap: wrap;
      gap: 1rem;
      margin-top: 1.5rem;
    }

    .kpi {
      flex: 1 1 220px;
      padding: 0.75rem;
      border-radius: 6px;
      border: 1px solid #ddd;
      background: #fafafa;
    }

    .kpi-label {
      font-size: 0.8rem;
      color: #666;
      margin-bottom: 0.15rem;
    }

    .kpi-value {
      font-size: 1.2rem;
      font-weight: bold;
    }

    table {
      border-collapse: collapse;
      width: 100%;
      margin-top: 1rem;
    }

    th, td {
      border: 1px solid #ddd;
      padding: 0.5rem;
      text-align: left;
      font-size: 0.9rem;
    }

    th {
      background: #f5f5f5;
    }

    .note {
      font-size: 0.8rem;
      color: #777;
      margin-top: 0.5rem;
    }
  </style>
</head>
<body>

  <h1>StaffHealth Stability Index (SHSI)</h1>
  <div class="subheading">
    Prototype to quantify workforce volatility and the hidden economic impact of PRN reliance, overtime,
    PBJ exposure, turnover, and schedule instability.
  </div>

  <!-- Simple tab-like nav -->
  <div class="nav-buttons">
    <button id="btnSingle" class="active">Single Community View</button>
    <button id="btnPortfolio">Portfolio View</button>
  </div>

  <!-- SINGLE COMMUNITY SECTION -->
  <div id="singleSection" class="section active">
    <h2>Single Community SHSI</h2>

    <div class="form-row">
      <div class="form-field">
        <label for="communityName">Community Name</label>
        <input type="text" id="communityName" placeholder="e.g., Autumn Leaves of Georgetown">
      </div>
      <div class="form-field">
        <label for="annualAgencyHours">Annual Agency / PRN Hours</label>
        <input type="number" id="annualAgencyHours" placeholder="e.g., 4800">
      </div>
      <div class="form-field">
        <label for="avgHourlyRateGap">Avg Rate Gap (Agency vs Internal) ($)</label>
        <input type="number" id="avgHourlyRateGap" step="0.01" placeholder="e.g., 8">
      </div>
    </div>

    <div class="form-row">
      <div class="form-field">
        <label for="overtimeHours">Annual Overtime Hours</label>
        <input type="number" id="overtimeHours" placeholder="e.g., 1200">
      </div>
      <div class="form-field">
        <label for="overtimePremiumPercent">Overtime Premium (%)</label>
        <input type="number" id="overtimePremiumPercent" placeholder="e.g., 50">
      </div>
      <div class="form-field">
        <label for="turnoverEvents">Annual Turnover Events (care staff)</label>
        <input type="number" id="turnoverEvents" placeholder="e.g., 12">
      </div>
    </div>

    <div class="form-row">
      <div class="form-field">
        <label for="avgReplacementCost">Avg Cost per Replacement ($)</label>
        <input type="number" id="avgReplacementCost" step="0.01" placeholder="e.g., 5500">
      </div>
      <div class="form-field">
        <label for="pbjRiskFactor">PBJ / Compliance Risk Factor (0–10)</label>
        <input type="number" id="pbjRiskFactor" step="0.1" placeholder="e.g., 4">
      </div>
      <div class="form-field">
        <label for="elasticityScore">Schedule Elasticity Score (0–10)</label>
        <input type="number" id="elasticityScore" step="0.1" placeholder="e.g., 6">
      </div>
    </div>

    <button id="btnCalculate">Calculate SHSI</button>

    <div class="kpi-row">
      <div class="kpi">
        <div class="kpi-label">SHSI Score (0–100; higher = more stable)</div>
        <div class="kpi-value" id="kpiShsi">–</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Estimated Annual Volatility Cost</div>
        <div class="kpi-value" id="kpiVolCost">$–</div>
      </div>
      <div class="kpi">
        <div class="kpi-label">Stabilizable Upside (StaffHealth + Verified)</div>
        <div class="kpi-value" id="kpiUpside">$–</div>
      </div>
    </div>

    <div class="note">
      Note: Model is intentionally conservative and designed for operator feedback. Many volatility
      costs are “below the P&amp;L waterline” (overtime drag, PBJ exposure, recruitment churn, coverage risk).
    </div>
  </div>

  <!-- PORTFOLIO SECTION -->
  <div id="portfolioSection" class="section">
    <h2>Portfolio View</h2>
    <p class="subheading">
      Portfolio-level view of SHSI and volatility cost. Edit the data array in the script to reflect your
      communities, or use this as a reference for your own export data.
    </p>

    <div id="portfolioTableContainer">
      <!-- Table will be injected here -->
    </div>

    <div class="note">
      Higher SHSI indicates greater workforce stability. Use this view to see where volatility is
      concentrated and where targeted interventions may unlock the most stabilizable upside.
    </div>
  </div>

  <!-- Inline JS so there are ZERO external file dependencies -->
  <script>
    document.addEventListener("DOMContentLoaded", function () {
      const btnSingle = document.getElementById("btnSingle");
      const btnPortfolio = document.getElementById("btnPortfolio");
      const singleSection = document.getElementById("singleSection");
      const portfolioSection = document.getElementById("portfolioSection");

      function showSection(section) {
        if (section === "single") {
          singleSection.classList.add("active");
          portfolioSection.classList.remove("active");
          btnSingle.classList.add("active");
          btnPortfolio.classList.remove("active");
        } else {
          singleSection.classList.remove("active");
          portfolioSection.classList.add("active");
          btnSingle.classList.remove("active");
          btnPortfolio.classList.add("active");
          buildPortfolioTable();
        }
      }

      btnSingle.addEventListener("click", function () {
        showSection("single");
      });

      btnPortfolio.addEventListener("click", function () {
        showSection("portfolio");
      });

      // === SINGLE COMMUNITY CALC LOGIC ===
      const btnCalculate = document.getElementById("btnCalculate");
      const kpiShsi = document.getElementById("kpiShsi");
      const kpiVolCost = document.getElementById("kpiVolCost");
      const kpiUpside = document.getElementById("kpiUpside");

      btnCalculate.addEventListener("click", function () {
        // Grab values
        const annualAgencyHours = Number(document.getElementById("annualAgencyHours").value) || 0;
        const avgHourlyRateGap = Number(document.getElementById("avgHourlyRateGap").value) || 0;
        const overtimeHours = Number(document.getElementById("overtimeHours").value) || 0;
        const overtimePremiumPercent = Number(document.getElementById("overtimePremiumPercent").value) || 0;
        const turnoverEvents = Number(document.getElementById("turnoverEvents").value) || 0;
        const avgReplacementCost = Number(document.getElementById("avgReplacementCost").value) || 0;
        const pbjRiskFactor = Number(document.getElementById("pbjRiskFactor").value) || 0;
        const elasticityScore = Number(document.getElementById("elasticityScore").value) || 0;

        // --- PLACEHOLDER CALC LOGIC ---
        // NOTE: Replace this with your real SHSI formula.
        // This is intentionally conservative and simple just so the UI works.

        const agencyCost = annualAgencyHours * avgHourlyRateGap;
        const overtimeCost = overtimeHours * (overtimePremiumPercent / 100) * 10; // rough placeholder
        const turnoverCost = turnoverEvents * avgReplacementCost;
        const pbjCost = pbjRiskFactor * 5000;        // rough placeholder penalty
        const elasticityPenalty = (10 - Math.min(elasticityScore, 10)) * 3000;

        const totalVolatilityCost = agencyCost + overtimeCost + turnoverCost + pbjCost + elasticityPenalty;

        // SHSI score (0–100, higher = more stable).
        // Start from 100 and subtract scaled volatility signals.
        let shsi = 100;

        const agencySignal = Math.min(annualAgencyHours / 1000, 20); // cap at 20 points
        const overtimeSignal = Math.min(overtimeHours / 250, 15);
        const turnoverSignal = Math.min(turnoverEvents * 1.2, 20);
        const pbjSignal = Math.min(pbjRiskFactor * 1.5, 15);
        const elasticitySignal = Math.min((10 - elasticityScore) * 1.5, 20);

        shsi -= (agencySignal + overtimeSignal + turnoverSignal + pbjSignal + elasticitySignal);
        shsi = Math.max(0, Math.min(100, shsi)); // clamp

        // Assume conservatively that 25% of volatility cost is stabilizable with the right strategy
        const stabilizableUpside = totalVolatilityCost * 0.25;

        // Update UI
        kpiShsi.textContent = shsi.toFixed(1);
        kpiVolCost.textContent = formatCurrency(totalVolatilityCost);
        kpiUpside.textContent = formatCurrency(stabilizableUpside);
      });

      function formatCurrency(value) {
        if (!value || isNaN(value)) return "$–";
        return "$" + value.toLocaleString(undefined, { maximumFractionDigits: 0 });
      }

      // === PORTFOLIO VIEW LOGIC ===
      // Edit this array with real communities / SHSI values once you have them
      const portfolioData = [
        {
          name: "Autumn Leaves of Georgetown",
          shsi: 78.2,
          volatilityCost: 185000
        },
        {
          name: "Sample Assisted Living A",
          shsi: 64.5,
          volatilityCost: 275000
        },
        {
          name: "Sample Memory Care B",
          shsi: 52.3,
          volatilityCost: 345000
        },
        {
          name: "Sample SNF C",
          shsi: 41.9,
          volatilityCost: 420000
        }
      ];

      function buildPortfolioTable() {
        const container = document.getElementById("portfolioTableContainer");

        if (!portfolioData || portfolioData.length === 0) {
          container.innerHTML = "<p>No portfolio data available.</p>";
          return;
        }

        let totalVolatility = 0;
        let totalUpside = 0;

        portfolioData.forEach(item => {
          totalVolatility += item.volatilityCost || 0;
          totalUpside += (item.volatilityCost || 0) * 0.25; // same conservative 25% assumption
        });

        let html = `
          <table>
            <thead>
              <tr>
                <th>Community</th>
                <th>SHSI Score (0–100)</th>
                <th>Estimated Volatility Cost</th>
                <th>Stabilizable Upside (Est.)</th>
              </tr>
            </thead>
            <tbody>
        `;

        portfolioData.forEach(item => {
          const vc = item.volatilityCost || 0;
          const upside = vc * 0.25;
          html += `
            <tr>
              <td>${item.name || ""}</td>
              <td>${item.shsi != null ? item.shsi.toFixed(1) : "–"}</td>
              <td>${formatCurrency(vc)}</td>
              <td>${formatCurrency(upside)}</td>
            </tr>
          `;
        });

        html += `
            </tbody>
            <tfoot>
              <tr>
                <th>Total Portfolio</th>
                <th>–</th>
                <th>${formatCurrency(totalVolatility)}</th>
                <th>${formatCurrency(totalUpside)}</th>
              </tr>
            </tfoot>
          </table>
        `;

        container.innerHTML = html;
      }

      // Optionally build once so it's ready when user clicks
      buildPortfolioTable();
    });
  </script>
</body>
</html>
